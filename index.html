<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinMarketCap - The world's cryptocurrency data authority</title>
    <meta name="description" content="View crypto prices and charts, including Bitcoin, Ethereum, XRP, and more. Earn free crypto. Market cap rankings, charts, and more">

    <!-- TradingView Mini Chart Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js"></script>

    <!-- Cryptocurrency Database -->
    <script src="crypto-data.js"></script>

    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script type="module">
        // ⚠️ IMPORTANT: Replace these with your actual Supabase credentials
        // Get these from your Supabase Dashboard > Settings > API
        const SUPABASE_URL = 'https://your-project-ref.supabase.co'; // Replace with your Supabase URL
        const SUPABASE_ANON_KEY = 'your-anon-key-here'; // Replace with your Supabase anon key

        // Initialize Supabase client
        const { createClient } = supabase;
        let supabaseClient;

        // Temporarily disable Supabase to prevent blank screen
        // Uncomment and configure when ready to use Supabase
        /*
        try {
            supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('✅ Supabase client initialized successfully');
        } catch (error) {
            console.error('❌ Failed to initialize Supabase client:', error);
            alert('Please configure your Supabase credentials in the HTML file');
        }
        */
        console.log('🔧 Supabase temporarily disabled - website will work without authentication');

        // Check for existing session on page load (disabled while Supabase is disabled)
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('✅ CoinMarketCap loaded successfully');
            // Session check disabled until Supabase is configured
            /*
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                updateUIForLoggedInUser(session.user);
            }
            */
        });

        window.signInWithGoogle = async () => {
            try {
                if (!supabaseClient) {
                    throw new Error('Supabase client not initialized. Please check your configuration.');
                }

                console.log('🔄 Initiating Google OAuth sign-in...');

                const { data, error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/public/coinmarketcap.html',
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent',
                        }
                    }
                });

                if (error) {
                    console.error('❌ OAuth error:', error);
                    throw error;
                }

                console.log('✅ OAuth redirect initiated');
                // OAuth redirect will handle the rest
            } catch (error) {
                console.error('❌ Google sign-in error:', error);

                if (error.message.includes('not initialized')) {
                    alert('⚠️ Authentication not configured. Please set up your Supabase credentials.');
                } else if (error.message.includes('Invalid login credentials')) {
                    alert('❌ Google sign-in failed. Please check your Supabase Google OAuth configuration.');
                } else {
                    alert('❌ Sign-in failed: ' + error.message);
                }
            }
        };

        window.signInWithEmail = async () => {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            if (!validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }

            try {
                // Check if user exists in localStorage (real user data)
                const userData = localStorage.getItem(email);
                if (!userData) {
                    alert('User not found. Please sign up first.');
                    return;
                }

                const user = JSON.parse(userData);

                // Simple password check (in real app, use proper authentication)
                if (user.password !== password) {
                    alert('Invalid password. Please try again.');
                    return;
                }

                // Check if user is blocked
                if (user.status === 'blocked') {
                    alert('Your account has been blocked by an administrator. Please contact support at customerservicecoinmarket24@gmail.com');
                    return;
                }

                // Update last login
                user.lastLogin = new Date().toLocaleDateString();
                localStorage.setItem(email, JSON.stringify(user));
                localStorage.setItem(`user_${user.userId}`, JSON.stringify(user));

                // Create user object for UI
                const userObj = {
                    id: user.userId,
                    email: email,
                    user_metadata: { email: email }
                };

                // Set session with auto-logout
                setUserSession(userObj);

                // Update UI for logged in user
                updateUserProfile(userObj);
                closeAuthModal();

                alert('Successfully signed in! Session will expire after 1 hour of inactivity.');
                console.log('Real user signed in with session management:', user);

            } catch (error) {
                console.error('Sign-in error:', error);
                alert('Sign-in failed: ' + error.message);
            }
        };

        window.signUpWithEmail = async () => {
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            if (!validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            try {
                // Create real user data for admin access - ALL NEW USERS START WITH $0
                const userId = email.replace('@', '_').replace('.', '_').replace(/[^a-zA-Z0-9_]/g, '_');
                const now = new Date();
                const userData = {
                    email: email,
                    password: password, // In real app, this would be hashed
                    balance: 0.00, // ALWAYS START WITH $0.00 BALANCE
                    status: 'active',
                    registrationDate: now.toLocaleDateString(),
                    registrationTime: now.toLocaleTimeString(),
                    lastLogin: now.toLocaleDateString(),
                    lastLoginTime: now.toLocaleTimeString(),
                    transactions: [],
                    userId: userId,
                    createdAt: now.getTime() // Real-time timestamp
                };

                // Store user data for real-time admin access
                localStorage.setItem(`user_${userId}`, JSON.stringify(userData));
                localStorage.setItem(email, JSON.stringify(userData));

                // Create user object for UI update
                const user = {
                    id: userId,
                    email: email,
                    user_metadata: { email: email }
                };

                // Update UI for logged in user
                updateUserProfile(user);
                closeAuthModal();

                alert('Account created successfully! Welcome to CoinMarketCap!');
                console.log('New real user registered:', userData);

            } catch (error) {
                console.error('Sign-up error:', error);
                alert('Sign-up failed: ' + error.message);
            }
        };

        window.signOutUser = async () => {
            // Use the new logout function
            logoutUser();
        };

        // Helper function to update UI for logged in user
        function updateUIForLoggedInUser(user) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('userName').textContent = user.email || user.user_metadata?.full_name || 'User';

            if (user.user_metadata?.avatar_url) {
                document.getElementById('userPhoto').src = user.user_metadata.avatar_url;
            }
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Coinbase redirect function
        window.redirectToCoinbase = function(symbol, action) {
            // Map crypto symbols to Coinbase trading pairs
            const coinbaseSymbols = {
                'BTC': 'BTC-USD',
                'ETH': 'ETH-USD',
                'USDT': 'USDT-USD',
                'XRP': 'XRP-USD',
                'BNB': 'BNB-USD',
                'SOL': 'SOL-USD',
                'USDC': 'USDC-USD'
            };

            const tradingPair = coinbaseSymbols[symbol] || `${symbol}-USD`;

            // Coinbase Pro trading URL
            const coinbaseUrl = `https://pro.coinbase.com/trade/${tradingPair}`;

            // Open in new tab
            window.open(coinbaseUrl, '_blank');
        };

        // Initialize mini charts for the table
        function initializeMiniCharts() {
            const cryptoSymbols = [
                { id: 'mini-chart-btc', symbol: 'BINANCE:BTCUSDT' },
                { id: 'mini-chart-eth', symbol: 'BINANCE:ETHUSDT' },
                { id: 'mini-chart-usdt', symbol: 'BINANCE:USDTUSD' },
                { id: 'mini-chart-xrp', symbol: 'BINANCE:XRPUSDT' },
                { id: 'mini-chart-bnb', symbol: 'BINANCE:BNBUSDT' },
                { id: 'mini-chart-sol', symbol: 'BINANCE:SOLUSDT' },
                { id: 'mini-chart-usdc', symbol: 'BINANCE:USDCUSDT' }
            ];

            cryptoSymbols.forEach(crypto => {
                // Create a simple sparkline chart using CSS and gradients
                // For a real implementation, you would use TradingView mini widgets
                const chartElement = document.getElementById(crypto.id);
                if (chartElement) {
                    // Create a simple animated sparkline
                    chartElement.innerHTML = `
                        <svg width="120" height="40" viewBox="0 0 120 40">
                            <defs>
                                <linearGradient id="gradient-${crypto.id}" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#48BB78;stop-opacity:0.1" />
                                    <stop offset="50%" style="stop-color:#48BB78;stop-opacity:0.8" />
                                    <stop offset="100%" style="stop-color:#48BB78;stop-opacity:0.1" />
                                </linearGradient>
                            </defs>
                            <path d="M5,30 Q30,${Math.random() * 20 + 10} 60,${Math.random() * 20 + 15} T115,${Math.random() * 20 + 10}"
                                  stroke="url(#gradient-${crypto.id})"
                                  stroke-width="2"
                                  fill="none"
                                  opacity="0.8"/>
                        </svg>
                    `;
                }
            });
        }

        // Initialize real-time charts for the table
        function initializeRealTimeCharts() {
            const chartContainers = document.querySelectorAll('.tradingview-widget');

            chartContainers.forEach(container => {
                if (!container.hasChildNodes()) {
                    const symbol = container.getAttribute('data-symbol');

                    // Create a simple real-time-looking chart
                    const chartId = `chart-${symbol.toLowerCase()}-${Date.now()}`;
                    container.id = chartId;

                    // Generate random price movement data
                    const points = [];
                    let basePrice = Math.random() * 100 + 10;
                    for (let i = 0; i < 20; i++) {
                        basePrice += (Math.random() - 0.5) * 5;
                        points.push(basePrice);
                    }

                    const maxPrice = Math.max(...points);
                    const minPrice = Math.min(...points);
                    const priceRange = maxPrice - minPrice || 1;

                    // Create SVG path
                    let pathData = '';
                    points.forEach((price, index) => {
                        const x = (index / (points.length - 1)) * 100;
                        const y = 40 - ((price - minPrice) / priceRange) * 30;
                        pathData += index === 0 ? `M${x},${y}` : ` L${x},${y}`;
                    });

                    const isPositive = points[points.length - 1] > points[0];
                    const color = isPositive ? '#48BB78' : '#F56565';

                    container.innerHTML = `
                        <svg width="100%" height="50" viewBox="0 0 100 40" style="overflow: visible;">
                            <defs>
                                <linearGradient id="gradient-${chartId}" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:${color};stop-opacity:0.3" />
                                    <stop offset="100%" style="stop-color:${color};stop-opacity:0.1" />
                                </linearGradient>
                            </defs>
                            <path d="${pathData} L100,40 L0,40 Z" fill="url(#gradient-${chartId})" opacity="0.3"/>
                            <path d="${pathData}" stroke="${color}" stroke-width="1.5" fill="none"/>
                        </svg>
                    `;
                }
            });
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0B1426;
            color: #FFFFFF;
            line-height: 1.5;
        }
        
        /* Header */
        .header {
            background: #17233D;
            border-bottom: 1px solid #2D3748;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 64px; /* Fixed header height */
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 64px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: bold;
            color: #FFFFFF;
            text-decoration: none;
            margin-right: 48px; /* Add space between logo and navigation */
            transition: all 0.3s ease;
        }

        .logo:hover {
            color: #3182CE;
            transform: translateY(-1px);
        }

        .logo:hover .logo-icon {
            transform: scale(1.1);
            background: #3182CE;
            border-color: #3182CE;
            box-shadow: 0 4px 12px rgba(49, 130, 206, 0.4);
        }

        .logo:hover .logo-icon::before {
            opacity: 1;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: #2B3139;
            border: 2px solid #FFFFFF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFFFFF;
            font-weight: 900;
            font-size: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            letter-spacing: -0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3182CE, #2C5282);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .nav {
            display: flex;
            align-items: center;
            gap: 32px;
            margin-right: 40px; /* Add space between navigation and search bar */
        }
        
        .nav-item {
            color: #A0AEC0;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.2s;
        }
        
        .nav-item:hover {
            color: #FFFFFF;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-box {
            background: #2D3748;
            border: 1px solid #4A5568;
            border-radius: 8px;
            padding: 8px 40px 8px 12px;
            color: #FFFFFF;
            font-size: 14px;
            width: 240px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            border-color: #3182CE;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
            outline: none;
        }

        .search-box::placeholder {
            color: #718096;
        }

        .search-btn {
            position: absolute;
            right: 8px;
            background: #3182CE;
            border: none;
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .search-btn:hover {
            background: #2C5282;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #2D3748;
            border: 1px solid #4A5568;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 4px;
        }

        .search-result-item {
            padding: 12px;
            border-bottom: 1px solid #4A5568;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s ease;
        }

        .search-result-item:hover {
            background: #4A5568;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: contain;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-name {
            color: #FFFFFF;
            font-weight: 600;
            font-size: 14px;
        }

        .search-result-symbol {
            color: #718096;
            font-size: 12px;
        }

        .search-result-price {
            color: #48BB78;
            font-weight: 600;
            font-size: 14px;
        }

        /* Floating Support Button */
        .floating-support {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #3182CE, #2C5282);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .floating-support:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(49, 130, 206, 0.4);
            background: linear-gradient(135deg, #2C5282, #2A4365);
        }

        .floating-support:active {
            transform: translateY(0);
        }

        /* Pull to Refresh Styles */
        .pull-to-refresh {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #3182CE, #2C5282);
            color: white;
            padding: 10px 20px;
            border-radius: 0 0 20px 20px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateX(-50%) translateY(-100%);
        }

        .pull-to-refresh.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .pull-to-refresh.refreshing {
            background: linear-gradient(135deg, #48BB78, #38A169);
        }

        .refresh-icon {
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.5s ease;
        }

        .refresh-icon.spinning {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .floating-support {
                bottom: 15px;
                left: 15px;
                padding: 10px 16px;
                font-size: 12px;
            }
        }
        
        .login-btn {
            background: #3182CE;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .login-btn:hover {
            background: #2C5282;
        }

        .wallet-balance {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #1A202C;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #4A5568;
        }

        .balance-label {
            color: #A0AEC0;
            font-size: 14px;
        }

        .balance-amount {
            color: #48BB78;
            font-weight: 600;
            font-size: 14px;
        }

        /* Transaction History */
        .transaction-history {
            margin-bottom: 32px;
        }

        .transaction-card {
            background: #1A202C;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2D3748;
        }

        .transaction-card h3 {
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transaction-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2D3748;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-type {
            color: #FFFFFF;
            font-weight: 500;
            font-size: 14px;
        }

        .transaction-date {
            color: #A0AEC0;
            font-size: 12px;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 14px;
        }

        .transaction-amount.positive {
            color: #48BB78;
        }

        .transaction-amount.negative {
            color: #F56565;
        }

        .no-transactions {
            text-align: center;
            padding: 40px 20px;
            color: #A0AEC0;
        }

        .no-transactions p {
            margin: 0;
            font-size: 14px;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1A202C;
            border: 1px solid #4A5568;
            border-radius: 8px;
            padding: 16px;
            max-width: 400px;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            border-color: #48BB78;
            background: linear-gradient(135deg, #1A202C, #22543D);
        }

        .notification.warning {
            border-color: #ED8936;
            background: linear-gradient(135deg, #1A202C, #744210);
        }

        .notification.info {
            border-color: #3182CE;
            background: linear-gradient(135deg, #1A202C, #2A4365);
        }

        .notification.error {
            border-color: #F56565;
            background: linear-gradient(135deg, #1A202C, #742A2A);
        }

        /* Notification Bell Icon */
        .notification-bell {
            position: relative;
            display: none; /* Initially hidden, shown when user logs in */
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .bell-icon {
            font-size: 18px;
            color: #FFFFFF;
        }

        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #F56565;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            min-width: 20px;
        }

        .notification-count.hidden {
            display: none;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .notification-icon {
            font-size: 18px;
        }

        .notification-message {
            color: #FFFFFF;
            font-size: 14px;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: #A0AEC0;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin-left: 12px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .notification-close:hover {
            background: #4A5568;
            color: #FFFFFF;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .user-profile {
            display: none;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
        }

        .user-photo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #3182CE;
            background: #3182CE;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            object-fit: cover;
        }

        .user-photo.placeholder {
            background: linear-gradient(135deg, #3182CE, #2C5282);
        }

        /* User Dropdown Menu */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: #1A202C;
            border: 1px solid #4A5568;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            padding: 16px;
            border-bottom: 1px solid #4A5568;
        }

        .user-dropdown-email {
            color: #E2E8F0;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .user-dropdown-status {
            color: #48BB78;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .user-dropdown-menu {
            padding: 8px 0;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #E2E8F0;
            text-decoration: none;
            transition: background 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .user-dropdown-item:hover {
            background: #2D3748;
        }

        .user-dropdown-item.logout {
            color: #F56565;
            border-top: 1px solid #4A5568;
        }

        .user-dropdown-item.logout:hover {
            background: rgba(245, 101, 101, 0.1);
        }

        .user-dropdown-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        /* Authentication Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .auth-modal {
            background: #1A202C;
            border-radius: 16px;
            width: 100%;
            max-width: 480px;
            margin: 20px;
            position: relative;
            border: 1px solid #2D3748;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #718096;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #2D3748;
            color: #FFFFFF;
        }

        .modal-header {
            padding: 32px 32px 0;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 32px;
        }

        .auth-tab {
            flex: 1;
            background: none;
            border: none;
            color: #718096;
            font-size: 18px;
            font-weight: 600;
            padding: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .auth-tab.active {
            color: #FFFFFF;
            border-bottom-color: #3182CE;
        }

        .auth-tab:hover {
            color: #FFFFFF;
        }

        .modal-content {
            padding: 0 32px 32px;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .social-login {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: #2D3748;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            padding: 14px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .social-btn:hover {
            background: #4A5568;
            border-color: #718096;
        }

        .social-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 24px 0;
            color: #718096;
            font-size: 14px;
            font-weight: 500;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #4A5568;
        }

        .divider span {
            padding: 0 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            background: #2D3748;
            border: 2px solid #4A5568;
            border-radius: 8px;
            padding: 14px 16px;
            color: #FFFFFF;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3182CE;
            background: #374151;
        }

        .form-input::placeholder {
            color: #718096;
        }

        .password-group {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            padding: 4px;
        }

        .forgot-password {
            text-align: right;
            margin-top: 8px;
        }

        .forgot-password a {
            color: #718096;
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-password a:hover {
            color: #3182CE;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            margin-top: 2px;
        }

        .checkbox-label {
            color: #A0AEC0;
            font-size: 13px;
            line-height: 1.4;
        }

        .checkbox-label a {
            color: #3182CE;
            text-decoration: none;
        }

        .checkbox-label a:hover {
            text-decoration: underline;
        }

        .submit-btn {
            width: 100%;
            background: #3182CE;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 8px;
        }

        .submit-btn:hover {
            background: #2C5282;
        }

        .submit-btn:disabled {
            background: #4A5568;
            cursor: not-allowed;
        }

        .terms {
            text-align: center;
            margin-top: 20px;
            color: #718096;
            font-size: 12px;
        }

        .terms a {
            color: #3182CE;
            text-decoration: none;
        }

        .terms a:hover {
            text-decoration: underline;
        }
        
        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 20px;
            padding-top: 80px; /* Much more space to prevent header overlap */
        }
        
        /* Stats Bar */
        .stats-bar {
            background: #1A202C;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 32px;
            overflow-x: auto;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 120px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }
        
        .stat-change {
            font-size: 12px;
            font-weight: 500;
        }
        
        .positive {
            color: #48BB78;
        }
        
        .negative {
            color: #F56565;
        }
        
        /* Trending Section */
        .trending-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .trending-card {
            background: #1A202C;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2D3748;
        }
        
        .trending-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .trending-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }
        
        .trending-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .trending-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .trending-coin {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .coin-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #F7931A, #FFB800);
        }
        
        .coin-name {
            font-size: 14px;
            font-weight: 500;
            color: #FFFFFF;
        }
        
        .coin-symbol {
            font-size: 12px;
            color: #718096;
        }
        
        .coin-price {
            font-size: 14px;
            font-weight: 500;
            color: #FFFFFF;
        }
        
        /* Main Table */
        .table-container {
            background: #1A202C;
            border-radius: 12px;
            border: 1px solid #2D3748;
            overflow: hidden;
            margin-top: 60px; /* Much more spacing from header */
            position: relative;
            z-index: 1; /* Below header but above other content */
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #2D3748;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #FFFFFF;
        }
        
        .table-filters {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .filter-btn {
            background: #2D3748;
            border: 1px solid #4A5568;
            color: #A0AEC0;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #3182CE;
            color: white;
            border-color: #3182CE;
        }
        
        .crypto-table {
            width: 100%;
            border-collapse: collapse; /* Collapse for clean lines */
            table-layout: fixed; /* Fixed layout for consistent columns */
            margin-top: 20px; /* Extra space from header */
        }
        
        .crypto-table th {
            background: #1A202C;
            padding: 12px 16px;
            text-align: left;
            font-size: 11px;
            font-weight: 500;
            color: #718096;
            border-bottom: 1px solid #2D3748;
            position: sticky;
            top: 64px;
            z-index: 10;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .crypto-table td {
            padding: 12px 16px; /* Compact padding like the image */
            border-bottom: 1px solid #2D3748; /* Clean border between rows */
            font-size: 14px;
            color: #E2E8F0;
            vertical-align: middle;
            background: #1A202C; /* Ensure background color */
        }

        /* Column styling with proper widths to match the image */
        .crypto-table th:nth-child(1),
        .crypto-table td:nth-child(1) {
            width: 40px;
            text-align: center;
            padding: 16px 8px;
        } /* Rank */

        .crypto-table th:nth-child(2),
        .crypto-table td:nth-child(2) {
            width: 200px;
            padding: 16px 12px;
        } /* Name */

        .crypto-table th:nth-child(3),
        .crypto-table td:nth-child(3) {
            width: 120px;
            text-align: right;
            padding: 16px 12px;
        } /* Price */

        .crypto-table th:nth-child(4),
        .crypto-table td:nth-child(4) {
            width: 80px;
            text-align: right;
            padding: 16px 8px;
        } /* 1h % */

        .crypto-table th:nth-child(5),
        .crypto-table td:nth-child(5) {
            width: 80px;
            text-align: right;
            padding: 16px 8px;
        } /* 24h % */

        .crypto-table th:nth-child(6),
        .crypto-table td:nth-child(6) {
            width: 80px;
            text-align: right;
            padding: 16px 8px;
        } /* 7d % */

        .crypto-table th:nth-child(7),
        .crypto-table td:nth-child(7) {
            width: 140px;
            text-align: right;
            padding: 16px 12px;
        } /* Market Cap */

        .crypto-table th:nth-child(8),
        .crypto-table td:nth-child(8) {
            width: 140px;
            text-align: right;
            padding: 16px 12px;
        } /* Volume */

        .crypto-table th:nth-child(9),
        .crypto-table td:nth-child(9) {
            width: 140px;
            text-align: right;
            padding: 16px 12px;
        } /* Circulating Supply */

        .crypto-table th:nth-child(10),
        .crypto-table td:nth-child(10) {
            width: 120px;
            text-align: center;
            padding: 16px 8px;
        } /* Chart */
        
        .crypto-table tr:hover {
            background: #2D3748;
        }

        /* Ensure all table rows are visible with clean styling */
        .crypto-table tbody tr {
            height: auto;
            min-height: 60px; /* Standard height for clean look */
            visibility: visible;
            display: table-row;
            transition: background-color 0.2s ease;
            cursor: pointer;
            background: #1A202C;
            border-bottom: 1px solid #2D3748;
        }

        .crypto-table tbody tr:hover {
            background: #2D3748;
        }

        .crypto-table tbody tr:last-child {
            border-bottom: none;
        }

        /* Specific fix for first row */
        .crypto-table tbody tr:first-child {
            visibility: visible !important;
            display: table-row !important;
            height: auto !important;
        }

        /* Bitcoin row specific fixes */
        .crypto-table tbody tr.bitcoin-row,
        .crypto-table tbody tr[data-rank="1"] {
            visibility: visible !important;
            display: table-row !important;
            height: auto !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1 !important;
            background: #1A202C !important;
        }

        /* Force all table cells in first row to be visible */
        .crypto-table tbody tr:first-child td,
        .crypto-table tbody tr.bitcoin-row td,
        .crypto-table tbody tr[data-rank="1"] td {
            visibility: visible !important;
            display: table-cell !important;
            opacity: 1 !important;
        }
        
        .rank {
            color: #718096;
            font-weight: 500;
            text-align: center;
            min-width: 40px;
        }
        
        .coin-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .coin-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: contain;
            background: #2D3748;
            padding: 2px;
            transition: all 0.3s ease;
        }

        .coin-logo:hover {
            transform: scale(1.1);
        }

        /* Fallback for broken images */
        .coin-logo[src*="placeholder"] {
            background: #3182CE;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .coin-info {
            display: flex;
            flex-direction: column;
        }
        
        .coin-name-main {
            font-weight: 600;
            color: #FFFFFF;
        }
        
        .coin-symbol-main {
            font-size: 12px;
            color: #718096;
        }

        /* Percentage change styling to match the image */
        .positive {
            color: #10B981 !important; /* Green for positive */
        }

        .negative {
            color: #EF4444 !important; /* Red for negative */
        }

        .neutral {
            color: #6B7280 !important; /* Gray for neutral */
        }

        /* Price styling */
        .price {
            font-weight: 600;
            color: #FFFFFF;
        }

        /* Market cap and volume styling */
        .market-data {
            font-size: 13px;
            color: #E2E8F0;
        }

        .market-data-small {
            font-size: 11px;
            color: #9CA3AF;
        }
        
        .price-cell {
            font-weight: 600;
            color: #FFFFFF;
        }
        
        .change-cell {
            font-weight: 500;
        }
        
        .market-cap {
            color: #A0AEC0;
        }
        
        .volume {
            color: #A0AEC0;
        }
        
        .supply {
            color: #A0AEC0;
        }
        
        .chart-cell {
            width: 120px;
            height: 40px;
            background: linear-gradient(90deg, transparent, #48BB78, transparent);
            border-radius: 4px;
            opacity: 0.3;
        }

        /* Removed Buy/Sell Button Styles - buttons moved to individual coin pages */

        /* Pagination Styles */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-top: 1px solid #2D3748;
            background: #1A202C;
        }

        .pagination-info {
            color: #718096;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn {
            background: #2D3748;
            border: 1px solid #4A5568;
            color: #A0AEC0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #4A5568;
            color: #FFFFFF;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-numbers {
            display: flex;
            gap: 4px;
        }

        .page-number {
            background: #2D3748;
            border: 1px solid #4A5568;
            color: #A0AEC0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 40px;
            text-align: center;
        }

        .page-number:hover {
            background: #4A5568;
            color: #FFFFFF;
        }

        .page-number.active {
            background: #3182CE;
            color: white;
            border-color: #3182CE;
        }

        .pagination-size {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #718096;
            font-size: 14px;
        }

        .pagination-size select {
            background: #2D3748;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Newsletter Section */
        .newsletter-section {
            background: linear-gradient(135deg, #1A202C 0%, #2D3748 100%);
            padding: 60px 20px;
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }

        .newsletter-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }

        .newsletter-text h2 {
            font-size: 2.5rem;
            color: #FFFFFF;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .newsletter-text p {
            color: #A0AEC0;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .newsletter-form {
            display: flex;
            gap: 12px;
            max-width: 400px;
        }

        .newsletter-input {
            flex: 1;
            padding: 12px 16px;
            background: #2D3748;
            border: 1px solid #4A5568;
            border-radius: 8px;
            color: #FFFFFF;
            font-size: 16px;
        }

        .newsletter-input::placeholder {
            color: #718096;
        }

        .newsletter-btn {
            background: #3182CE;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .newsletter-btn:hover {
            background: #2C5AA0;
        }

        .newsletter-graphic {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .crypto-icons {
            display: flex;
            gap: 20px;
            opacity: 0.3;
        }

        .crypto-icon {
            width: 60px;
            height: 60px;
            background: #3182CE;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        .crypto-icon:nth-child(2) {
            animation-delay: 1s;
        }

        .crypto-icon:nth-child(3) {
            animation-delay: 2s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Footer */
        .footer {
            background: #0B1426;
            padding: 40px 20px 20px;
            border-top: 1px solid #2D3748;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-logo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2D3748;
        }

        .footer-language {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .language-select {
            background: #1A202C;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .currency-select {
            background: #1A202C;
            border: 1px solid #4A5568;
            color: #FFFFFF;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .footer-columns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
        }

        .footer-column h3 {
            color: #FFFFFF;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .footer-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-column li {
            margin-bottom: 8px;
        }

        .footer-column a {
            color: #A0AEC0;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
        }

        .footer-column a:hover {
            color: #3182CE;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .header {
                padding: 12px 15px;
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .trending-section {
                grid-template-columns: 1fr;
                margin: 0 -15px;
                padding: 0 15px;
            }

            .stats-bar {
                gap: 12px;
                flex-wrap: wrap;
                justify-content: center;
                padding: 16px 10px;
            }

            .stat-item {
                min-width: 120px;
                text-align: center;
            }

            .nav {
                display: none;
            }

            .logo {
                margin-right: 15px;
                font-size: 16px;
                white-space: nowrap;
            }

            .search-container {
                width: 150px;
                flex-shrink: 0;
            }

            .search-box {
                width: 100%;
                padding: 8px 30px 8px 10px;
                font-size: 14px;
            }

            .newsletter-content {
                grid-template-columns: 1fr;
                text-align: center;
                padding: 40px 20px;
            }

            .newsletter-text h2 {
                font-size: 1.8rem;
            }

            .footer-columns {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .footer-logo {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            /* Responsive Table Styles */
            .crypto-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -15px;
                padding: 0 15px;
                border-radius: 0;
            }

            .crypto-table {
                min-width: 800px; /* Ensure enough space for all columns */
            }

            .crypto-table th,
            .crypto-table td {
                padding: 10px 8px;
                font-size: 12px;
                white-space: nowrap;
            }

            /* Adjust column widths for mobile */
            .crypto-table th:nth-child(1),
            .crypto-table td:nth-child(1) {
                width: 40px;
                min-width: 40px;
            } /* Rank */

            .crypto-table th:nth-child(2),
            .crypto-table td:nth-child(2) {
                width: 150px;
                min-width: 150px;
            } /* Name */

            .coin-logo {
                width: 24px;
                height: 24px;
            }

            .coin-info {
                gap: 2px;
            }

            .coin-name-main {
                font-size: 12px;
            }

            .coin-symbol-main {
                font-size: 10px;
            }

            /* Hide less important columns on mobile */
            .crypto-table th:nth-child(4), /* 1h % */
            .crypto-table td:nth-child(4) {
                display: none;
            }

            .crypto-table th:nth-child(8), /* Volume */
            .crypto-table td:nth-child(8) {
                display: none;
            }

            .crypto-table th:nth-child(9), /* Circulating Supply */
            .crypto-table td:nth-child(9) {
                display: none;
            }

            /* Keep essential columns visible */
            .crypto-table th:nth-child(1), /* Rank */
            .crypto-table th:nth-child(2), /* Name */
            .crypto-table th:nth-child(3), /* Price */
            .crypto-table th:nth-child(5), /* 24h % */
            .crypto-table th:nth-child(6), /* 7d % */
            .crypto-table th:nth-child(7), /* Market Cap */
            .crypto-table th:nth-child(10) /* Chart */
            {
                display: table-cell;
            }

            /* Pagination responsive */
            .pagination-container {
                flex-direction: column;
                gap: 15px;
                padding: 20px 15px;
            }

            .pagination-controls {
                justify-content: center;
            }

            .pagination-numbers {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        /* Additional responsive styles for very small screens */
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }

            .header {
                padding: 12px 10px;
            }

            .logo {
                font-size: 16px;
                margin-right: 10px;
            }

            .search-container {
                width: 140px;
            }

            .crypto-table th,
            .crypto-table td {
                padding: 8px 4px;
                font-size: 11px;
            }

            .coin-logo {
                width: 20px;
                height: 20px;
            }

            .coin-name-main {
                font-size: 12px;
            }

            .coin-symbol-main {
                font-size: 10px;
            }

            /* Stack action buttons vertically on very small screens */
            .crypto-table th:nth-child(8), /* Actions column */
            .crypto-table td:nth-child(8) {
                min-width: 80px;
            }

            .buy-btn, .sell-btn {
                padding: 4px 8px;
                font-size: 10px;
                margin: 1px;
            }

            /* User dropdown responsive */
            .user-dropdown {
                right: -10px;
                min-width: 180px;
            }

            .user-dropdown-item {
                padding: 10px 12px;
                font-size: 13px;
            }

            .user-photo {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
        }

        /* Ensure table container has proper styling */
        .crypto-table-container {
            background: #1A202C;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Improve coin logo loading and display */
        .coin-logo {
            object-fit: cover;
            background: #2D3748;
            border: 1px solid #4A5568;
        }

        .coin-logo[src*="placeholder"],
        .coin-logo[src*="data:image/svg"] {
            border: none;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .buy-btn, .sell-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 50px;
        }

        .buy-btn {
            background: #48BB78;
            color: white;
        }

        .buy-btn:hover {
            background: #38A169;
            transform: translateY(-1px);
        }

        .sell-btn {
            background: #F56565;
            color: white;
        }

        .sell-btn:hover {
            background: #E53E3E;
            transform: translateY(-1px);
        }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="coinmarketcap.html" class="logo">
                <div class="logo-icon">M</div>
                CoinMarketCap
            </a>
            
            <nav class="nav">
                <a href="coinmarketcap.html" class="nav-item">Cryptocurrencies</a>
                <a href="#" class="nav-item">DexScan</a>
                <a href="#" class="nav-item">Exchanges</a>
                <a href="#" class="nav-item">Community</a>
                <a href="#" class="nav-item">Products</a>
                <a href="mailto:customerservicecoinmarket24@gmail.com?subject=CoinMarketCap Support Request&body=Hello CoinMarketCap Support Team,%0D%0A%0D%0AI need assistance with:%0D%0A%0D%0APlease describe your issue here...%0D%0A%0D%0AThank you!"
                   class="nav-item"
                   style="color: #f0b90b; font-weight: 600;"
                   title="Contact Support">
                    📧 Support
                </a>
            </nav>
            
            <div class="header-right">
                <div class="search-container">
                    <input type="text" id="searchBox" class="search-box" placeholder="Search cryptocurrencies...">
                    <button class="search-btn" onclick="performSearch()">🔍</button>
                    <div id="searchResults" class="search-results"></div>
                </div>
                <div id="walletBalance" class="wallet-balance">
                    <span class="balance-label">Balance:</span>
                    <span class="balance-amount">$0.00</span>
                </div>

                <!-- Notification Bell Icon -->
                <div id="notificationBell" class="notification-bell" onclick="openNotificationsPage()" title="View Notifications">
                    <span class="bell-icon">🔔</span>
                    <span id="notificationCount" class="notification-count">0</span>
                </div>

                <button id="loginBtn" class="login-btn" onclick="openAuthModal()">Log In</button>
                <div id="userProfile" class="user-profile" onclick="toggleUserDropdown()">
                    <div id="userPhoto" class="user-photo placeholder">
                        <span id="userInitials"></span>
                    </div>
                    <span id="userName"></span>
                    <span style="margin-left: 4px; color: #A0AEC0;">▼</span>

                    <!-- User Dropdown Menu -->
                    <div id="userDropdown" class="user-dropdown">
                        <div class="user-dropdown-header">
                            <div id="dropdownEmail" class="user-dropdown-email"></div>
                            <div class="user-dropdown-status">
                                <span style="color: #48BB78;">●</span>
                                Online
                            </div>
                        </div>
                        <div class="user-dropdown-menu">
                            <button class="user-dropdown-item" onclick="openNotificationsPage()">
                                <span class="user-dropdown-icon">🔔</span>
                                Notifications
                            </button>
                            <button class="user-dropdown-item" onclick="showTransactionHistory()">
                                <span class="user-dropdown-icon">📊</span>
                                Transaction History
                            </button>
                            <button class="user-dropdown-item logout" onclick="logoutUser()">
                                <span class="user-dropdown-icon">🚪</span>
                                Log Out
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notifications Page Modal -->
    <div id="notificationsModal" class="modal-overlay">
        <div class="auth-modal" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <button class="close-btn" onclick="closeNotificationsPage()">&times;</button>

            <div class="modal-header">
                <h2 style="color: #FFFFFF; margin: 0; text-align: center;">🔔 Your Notifications</h2>
            </div>

            <div id="notificationsList" class="notifications-list" style="margin-top: 20px;">
                <!-- Notifications will be populated here -->
            </div>

            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #4A5568;">
                <button onclick="clearAllNotifications()"
                        style="background: #F56565; color: white; border: none; padding: 12px 24px;
                               border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                    🗑️ Clear All Notifications
                </button>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal-overlay">
        <div class="auth-modal">
            <button class="close-btn" onclick="closeAuthModal()">&times;</button>

            <div class="modal-header">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchTab('login')">Log In</button>
                    <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
                </div>
            </div>

            <div class="modal-content">
                <!-- Login Form -->
                <div id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email address...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-group">
                            <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password...">
                            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">👁</button>
                        </div>
                        <div class="forgot-password">
                            <a href="#" onclick="showForgotPasswordPopup()">Forgot password?</a>
                        </div>
                    </div>

                    <button class="submit-btn" onclick="signInWithEmail()">Log In</button>

                    <!-- Social login removed as requested -->
                </div>

                <!-- Sign Up Form -->
                <div id="signupForm" class="auth-form">
                    <!-- Social login removed as requested -->

                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signupEmail" class="form-input" placeholder="Enter your email address...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-group">
                            <input type="password" id="signupPassword" class="form-input" placeholder="Enter your password...">
                            <button type="button" class="password-toggle" onclick="togglePassword('signupPassword')">👁</button>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="emailUpdates" class="checkbox" checked>
                        <label for="emailUpdates" class="checkbox-label">
                            Please keep me updated by email with the latest crypto news, research findings, reward programs, event updates, coin listings and more information from CoinMarketCap.
                        </label>
                    </div>

                    <button class="submit-btn" onclick="signUpWithEmail()">Create an account</button>

                    <div class="terms">
                        By proceeding, you agree to CoinMarketCap's <a href="#">Terms of Use</a> & <a href="#">Privacy Policy</a>.
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Main Content -->
    <main class="main-content">
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">Cryptos</div>
                <div class="stat-value">2.8M+</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Exchanges</div>
                <div class="stat-value">753</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Market Cap</div>
                <div class="stat-value">$3.33T</div>
                <div class="stat-change positive">+1.09%</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">24h Vol</div>
                <div class="stat-value">$69.3B</div>
                <div class="stat-change negative">-18.2%</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Dominance</div>
                <div class="stat-value">BTC 54.6% ETH 12.9%</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ETH Gas</div>
                <div class="stat-value">24 Gwei</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Fear & Greed</div>
                <div class="stat-value">60/100</div>
            </div>
        </div>

        <!-- Transaction History Section (shown when user is logged in) -->
        <div id="transactionHistory" class="transaction-history" style="display: none;">
            <div class="transaction-card">
                <h3>💰 Transaction History</h3>
                <div id="transactionList" class="transaction-list">
                    <!-- Transactions will be populated here -->
                    <div class="no-transactions">
                        <p>No transactions yet. Your wallet activity will appear here.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trending Section -->
        <div class="trending-section">
            <div class="trending-card">
                <div class="trending-header">
                    <div class="trending-title">🔥 Trending Coins</div>
                </div>
                <div class="trending-list">
                    <div class="trending-item">
                        <div class="trending-coin">
                            <div class="coin-icon" style="background: linear-gradient(135deg, #F7931A, #FFB800);"></div>
                            <div>
                                <div class="coin-name">RARI</div>
                                <div class="coin-symbol">RARI</div>
                            </div>
                        </div>
                        <div class="coin-price">$102</div>
                    </div>
                    <div class="trending-item">
                        <div class="trending-coin">
                            <div class="coin-icon" style="background: linear-gradient(135deg, #627EEA, #8B5CF6);"></div>
                            <div>
                                <div class="coin-name">ZRC</div>
                                <div class="coin-symbol">ZRC</div>
                            </div>
                        </div>
                        <div class="coin-price">$0.0239</div>
                    </div>
                    <div class="trending-item">
                        <div class="trending-coin">
                            <div class="coin-icon" style="background: linear-gradient(135deg, #14F195, #00D4AA);"></div>
                            <div>
                                <div class="coin-name">SAHARA</div>
                                <div class="coin-symbol">SAHARA</div>
                            </div>
                        </div>
                        <div class="coin-price">$0.1039</div>
                    </div>
                </div>
            </div>

            <div class="trending-card">
                <div class="trending-header">
                    <div class="trending-title">📊 Market Cap</div>
                </div>
                <div class="trending-list">
                    <div class="stat-value">$3.33T</div>
                    <div class="stat-change positive">+1.09%</div>
                </div>
            </div>

            <div class="trending-card">
                <div class="trending-header">
                    <div class="trending-title">🪙 CMC100</div>
                </div>
                <div class="trending-list">
                    <div class="stat-value">$204.27</div>
                    <div class="stat-change positive">+1.02%</div>
                </div>
            </div>
        </div>

        <!-- Main Table -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">Today's Cryptocurrency Prices by Market Cap</div>
                <div class="table-filters">
                    <button class="filter-btn active">All Crypto</button>
                    <button class="filter-btn">NFTs</button>
                    <button class="filter-btn">Categories</button>
                    <button class="filter-btn">Token unlocks</button>
                    <button class="filter-btn">🔥 Trending</button>
                    <button class="filter-btn">🎮 Gaming</button>
                    <button class="filter-btn">🌱 DeFi</button>
                    <button class="filter-btn">🎨 NFT</button>
                    <button class="filter-btn">🏛️ DeFi</button>
                </div>
            </div>

            <div class="crypto-table-container">
                <table class="crypto-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>1h %</th>
                        <th>24h %</th>
                        <th>7d %</th>
                        <th>Market Cap</th>
                        <th>Volume(24h)</th>
                        <th>Circulating Supply</th>
                        <th>Last 7 Days</th>

                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic content will be loaded here by JavaScript -->
                </tbody>
            </table>
            </div>

            <!-- Pagination Controls -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Showing 1-50 of 250 cryptocurrencies</span>
                </div>
                <div class="pagination-controls">
                    <button id="prevPage" class="pagination-btn" onclick="changePage(-1)">← Previous</button>
                    <div class="pagination-numbers" id="paginationNumbers">
                        <!-- Page numbers will be generated here -->
                    </div>
                    <button id="nextPage" class="pagination-btn" onclick="changePage(1)">Next →</button>
                </div>
                <div class="pagination-size">
                    <label for="pageSize">Show:</label>
                    <select id="pageSize" onchange="changePageSize()">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                    </select>
                    <span>per page</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Pagination variables
        let currentPage = 1;
        let pageSize = 50;
        let totalCryptos = 0;
        let filteredCryptos = [];

        // Initialize pagination and load data
        function initializeCryptoTable() {
            console.log('🔄 Initializing crypto table...');
            console.log('📊 Window.cryptoDatabase exists:', !!window.cryptoDatabase);
            console.log('📊 Database length:', window.cryptoDatabase ? window.cryptoDatabase.length : 'undefined');

            if (window.cryptoDatabase && window.cryptoDatabase.length > 0) {
                console.log('✅ Crypto database loaded with', window.cryptoDatabase.length, 'cryptocurrencies');
                console.log('🥇 First crypto:', window.cryptoDatabase[0]);
                console.log('🥈 Second crypto:', window.cryptoDatabase[1]);

                totalCryptos = window.cryptoDatabase.length;
                filteredCryptos = [...window.cryptoDatabase];

                // Sort by rank to ensure Bitcoin is first
                filteredCryptos.sort((a, b) => a.rank - b.rank);
                console.log('🔢 After sorting, first crypto:', filteredCryptos[0]);

                loadTableData();
                updatePaginationControls();
            } else {
                console.error('❌ Crypto database not loaded or empty');
                console.log('🔍 Checking if crypto-data.js script loaded...');

                // Multiple retry attempts with different delays
                const retryAttempts = [500, 1000, 2000];
                retryAttempts.forEach((delay, index) => {
                    setTimeout(() => {
                        console.log(`🔄 Retry attempt ${index + 1} after ${delay}ms`);
                        if (window.cryptoDatabase && window.cryptoDatabase.length > 0) {
                            console.log('✅ Crypto database loaded on retry', index + 1);
                            totalCryptos = window.cryptoDatabase.length;
                            filteredCryptos = [...window.cryptoDatabase];
                            filteredCryptos.sort((a, b) => a.rank - b.rank);
                            loadTableData();
                            updatePaginationControls();
                        } else {
                            console.error(`❌ Retry ${index + 1} failed - database still not available`);
                        }
                    }, delay);
                });
            }
        }

        // Load table data for current page
        function loadTableData() {
            console.log('📊 Loading table data...');
            console.log('📄 Current page:', currentPage);
            console.log('📏 Page size:', pageSize);
            console.log('🔢 Total filtered cryptos:', filteredCryptos.length);

            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageData = filteredCryptos.slice(startIndex, endIndex);

            console.log('📍 Start index:', startIndex);
            console.log('📍 End index:', endIndex);
            console.log('📋 Page data length:', pageData.length);
            console.log('🥇 First crypto in page data:', pageData[0]);

            const tbody = document.querySelector('.crypto-table tbody');
            tbody.innerHTML = '';

            pageData.forEach((crypto, index) => {
                console.log(`📝 Processing crypto ${index + 1}:`, crypto.name, `(Rank: ${crypto.rank})`);
                const row = createCryptoRow(crypto);
                tbody.appendChild(row);

                // Special debugging and aggressive fix for first row
                if (index === 0) {
                    console.log('🥇 BITCOIN ROW DEBUG:');
                    console.log('🥇 Crypto data:', crypto);
                    console.log('🥇 Row created:', row);
                    console.log('🥇 Row HTML:', row.innerHTML);
                    console.log('🥇 Row in DOM:', tbody.children[0]);

                    // Aggressive visibility fixes for first row
                    row.style.cssText = `
                        visibility: visible !important;
                        display: table-row !important;
                        height: auto !important;
                        opacity: 1 !important;
                        position: relative !important;
                        z-index: 1 !important;
                        background: #1A202C !important;
                    `;

                    // Add a special class for first row
                    row.classList.add('bitcoin-row');
                    row.setAttribute('data-rank', '1');

                    console.log('🥇 Applied aggressive fixes to Bitcoin row');
                    console.log('🥇 Final row style:', row.style.cssText);
                }
            });

            // Initialize real-time charts for new rows
            setTimeout(() => {
                initializeRealTimeCharts();
            }, 500);
        }

        // Create a cryptocurrency table row
        function createCryptoRow(crypto) {
            console.log(`🔨 Creating row for ${crypto.name} (Rank: ${crypto.rank})`);
            const row = document.createElement('tr');

            const changeClass1h = crypto.change1h >= 0 ? 'positive' : 'negative';
            const changeClass24h = crypto.change24h >= 0 ? 'positive' : 'negative';
            const changeClass7d = crypto.change7d >= 0 ? 'positive' : 'negative';

            const formatPrice = (price) => {
                if (price >= 1) {
                    return '$' + price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                } else {
                    return '$' + price.toFixed(6);
                }
            };

            const formatChange = (change) => {
                const sign = change >= 0 ? '+' : '';
                return `${sign}${change.toFixed(2)}%`;
            };

            const formatMarketCap = (value) => {
                if (value >= 1e12) return '$' + (value / 1e12).toFixed(2) + 'T';
                if (value >= 1e9) return '$' + (value / 1e9).toFixed(2) + 'B';
                if (value >= 1e6) return '$' + (value / 1e6).toFixed(2) + 'M';
                return '$' + value.toLocaleString();
            };

            const formatSupply = (supply, symbol) => {
                if (supply >= 1e12) return (supply / 1e12).toFixed(1) + 'T ' + symbol;
                if (supply >= 1e9) return (supply / 1e9).toFixed(1) + 'B ' + symbol;
                if (supply >= 1e6) return (supply / 1e6).toFixed(1) + 'M ' + symbol;
                return supply.toLocaleString() + ' ' + symbol;
            };

            const iconUrl = getCoinIcon(crypto);
            console.log(`🪙 Loading icon for ${crypto.name} (${crypto.symbol}):`, iconUrl);

            row.innerHTML = `
                <td class="rank">${crypto.rank}</td>
                <td class="coin-cell">
                    <img src="${iconUrl}"
                         alt="${crypto.name}"
                         class="coin-logo"
                         onerror="handleIconError(this, '${crypto.symbol}')"
                         onload="console.log('✅ Icon loaded for ${crypto.symbol}');"
                         style="display: block;">
                    <div class="coin-info">
                        <div class="coin-name-main">
                            <a href="coin-detail.html?coin=${crypto.name.toLowerCase().replace(/\s+/g, '-')}"
                               style="color: #E2E8F0; text-decoration: none;">
                                ${crypto.name}
                            </a>
                        </div>
                        <div class="coin-symbol-main">${crypto.symbol}</div>
                    </div>
                </td>
                <td class="price-cell">${formatPrice(crypto.price)}</td>
                <td class="change-cell ${changeClass1h}">${formatChange(crypto.change1h)}</td>
                <td class="change-cell ${changeClass24h}">${formatChange(crypto.change24h)}</td>
                <td class="change-cell ${changeClass7d}">${formatChange(crypto.change7d)}</td>
                <td class="market-cap">${formatMarketCap(crypto.marketCap)}</td>
                <td class="volume">${formatMarketCap(crypto.volume24h)}</td>
                <td class="supply">${formatSupply(crypto.circulatingSupply, crypto.symbol)}</td>
                <td class="chart-cell">
                    <div class="tradingview-widget-container" style="width: 100%; height: 50px;">
                        <div class="tradingview-widget" data-symbol="${crypto.symbol}USDT" style="width: 100%; height: 100%;"></div>
                    </div>
                </td>
            `;

            // Row styling (no longer fully clickable)
            row.style.cursor = 'default';

            return row;
        }

        // Change page
        function changePage(direction) {
            const totalPages = Math.ceil(filteredCryptos.length / pageSize);
            const newPage = currentPage + direction;

            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                loadTableData();
                updatePaginationControls();

                // Scroll to top of table
                document.querySelector('.table-container').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Go to specific page
        function goToPage(page) {
            const totalPages = Math.ceil(filteredCryptos.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                loadTableData();
                updatePaginationControls();

                // Scroll to top of table
                document.querySelector('.table-container').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Change page size
        function changePageSize() {
            const newPageSize = parseInt(document.getElementById('pageSize').value);
            pageSize = newPageSize;
            currentPage = 1; // Reset to first page
            loadTableData();
            updatePaginationControls();
        }

        // Update pagination controls
        function updatePaginationControls() {
            const totalPages = Math.ceil(filteredCryptos.length / pageSize);
            const startIndex = (currentPage - 1) * pageSize + 1;
            const endIndex = Math.min(currentPage * pageSize, filteredCryptos.length);

            // Update pagination info
            document.getElementById('paginationInfo').textContent =
                `Showing ${startIndex}-${endIndex} of ${filteredCryptos.length} cryptocurrencies`;

            // Update prev/next buttons
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;

            // Update page numbers
            const paginationNumbers = document.getElementById('paginationNumbers');
            paginationNumbers.innerHTML = '';

            // Show page numbers (max 7 pages visible)
            const maxVisiblePages = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => goToPage(i);
                paginationNumbers.appendChild(pageBtn);
            }
        }

        // Add interactive functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for crypto-data.js to load, then initialize table
            setTimeout(() => {
                console.log('🔄 Attempting to initialize crypto table...');
                initializeCryptoTable();
            }, 500);

            // Also try immediate initialization
            initializeCryptoTable();
            // Filter buttons functionality
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Table row hover effects and navigation
            const tableRows = document.querySelectorAll('.crypto-table tbody tr');
            tableRows.forEach(row => {
                row.style.cursor = 'pointer';
                row.addEventListener('click', function() {
                    const coinName = this.querySelector('.coin-name-main').textContent.toLowerCase();
                    const coinSymbol = this.querySelector('.coin-symbol-main').textContent.toLowerCase();

                    // Map coin names to IDs for URL
                    const coinMap = {
                        'bitcoin': 'bitcoin',
                        'ethereum': 'ethereum',
                        'tether': 'tether',
                        'xrp': 'xrp',
                        'bnb': 'bnb',
                        'solana': 'solana',
                        'usdc': 'usdc'
                    };

                    const coinId = coinMap[coinName] || coinName;
                    window.location.href = `coin-detail.html?coin=${coinId}`;
                });
            });

            // Enhanced Search Functionality with Real-time Results
            const searchBox = document.getElementById('searchBox');
            const searchResults = document.getElementById('searchResults');
            let searchTimeout;

            // Real-time search as user types
            searchBox.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.toLowerCase().trim();

                if (searchTerm.length === 0) {
                    hideSearchResults();
                    showAllCoins();
                    return;
                }

                // Debounce search for better performance
                searchTimeout = setTimeout(() => {
                    performRealTimeSearch(searchTerm);
                }, 150);
            });

            // Hide search results when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.search-container')) {
                    hideSearchResults();
                }
            });

            // Handle Enter key for search
            searchBox.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    performSearch();
                }
            });

            function performRealTimeSearch(searchTerm) {
                // Filter table rows
                filterTableRows(searchTerm);

                // Show search dropdown results
                showSearchDropdown(searchTerm);
            }

            function filterTableRows(searchTerm) {
                // Filter the crypto data and reload table
                if (searchTerm) {
                    filteredCryptos = window.cryptoDatabase.filter(crypto =>
                        crypto.name.toLowerCase().includes(searchTerm) ||
                        crypto.symbol.toLowerCase().includes(searchTerm)
                    );
                } else {
                    filteredCryptos = [...window.cryptoDatabase];
                }

                // Reset to first page and reload
                currentPage = 1;
                loadTableData();
                updatePaginationControls();
            }

            function showSearchDropdown(searchTerm) {
                const matchingCoins = getAllCoins().filter(coin =>
                    coin.name.toLowerCase().includes(searchTerm) ||
                    coin.symbol.toLowerCase().includes(searchTerm)
                ).slice(0, 8); // Show top 8 results

                if (matchingCoins.length === 0) {
                    searchResults.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #718096;">
                            No cryptocurrencies found for "${searchTerm}"
                        </div>
                    `;
                } else {
                    searchResults.innerHTML = matchingCoins.map(coin => `
                        <div class="search-result-item" onclick="selectCoin('${coin.symbol}', '${coin.name}')">
                            <img src="${getCoinIcon(coin)}"
                                 alt="${coin.name}"
                                 class="search-result-icon"
                                 onerror="handleIconError(this, '${coin.symbol}')">
                            <div class="search-result-info">
                                <div class="search-result-name">${coin.name}</div>
                                <div class="search-result-symbol">${coin.symbol}</div>
                            </div>
                            <div class="search-result-price">${formatPrice(coin.price)}</div>
                        </div>
                    `).join('');
                }

                searchResults.style.display = 'block';
            }

            function getAllCoins() {
                // Return crypto database if available
                return window.cryptoDatabase && window.cryptoDatabase.length > 0 ? window.cryptoDatabase : [];
            }

            function selectCoin(symbol, name) {
                searchBox.value = `${name} (${symbol})`;
                hideSearchResults();

                // Filter to show only selected coin
                filterTableRows(symbol.toLowerCase());

                // Optional: Navigate to coin detail page
                const coinId = name.toLowerCase().replace(/\s+/g, '-');
                // window.location.href = `coin-detail.html?coin=${coinId}`;
            }

            function performSearch() {
                const searchTerm = searchBox.value.toLowerCase().trim();
                if (searchTerm) {
                    performRealTimeSearch(searchTerm);
                }
            }

            function hideSearchResults() {
                searchResults.style.display = 'none';
            }

            function showAllCoins() {
                // Reset filter to show all coins
                filteredCryptos = [...window.cryptoDatabase];
                currentPage = 1;
                loadTableData();
                updatePaginationControls();
            }

            // Initialize mini charts
            initializeMiniCharts();

            // Simulate real-time price updates
            setInterval(() => {
                const priceCells = document.querySelectorAll('.price-cell');
                priceCells.forEach(cell => {
                    const currentPrice = parseFloat(cell.textContent.replace('$', '').replace(',', ''));
                    const change = (Math.random() - 0.5) * 0.02; // ±1% change
                    const newPrice = currentPrice * (1 + change);

                    if (currentPrice > 1) {
                        cell.textContent = '$' + newPrice.toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    } else {
                        cell.textContent = '$' + newPrice.toFixed(4);
                    }
                });
            }, 5000); // Update every 5 seconds
        });

        // Authentication Modal Functions
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            // Focus on email input
            setTimeout(() => {
                document.getElementById('loginEmail').focus();
            }, 100);
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            // Clear form inputs
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.auth-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');

            // Update forms
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');

            // Focus on appropriate input
            if (tab === 'login') {
                setTimeout(() => document.getElementById('loginEmail').focus(), 100);
            } else {
                setTimeout(() => document.getElementById('signupEmail').focus(), 100);
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;

            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = '🙈';
            } else {
                input.type = 'password';
                button.textContent = '👁';
            }
        }

        // Handle Enter key press in modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && document.getElementById('authModal').classList.contains('active')) {
                const activeForm = document.querySelector('.auth-form.active');
                if (activeForm.id === 'loginForm') {
                    signInWithEmail();
                } else {
                    signUpWithEmail();
                }
            }

            // Handle Escape key to close modal
            if (event.key === 'Escape' && document.getElementById('authModal').classList.contains('active')) {
                closeAuthModal();
            }
        });

        // Handle click outside modal to close
        document.getElementById('authModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeAuthModal();
            }
        });

        // Transaction Management Functions
        function updateWalletBalance(newBalance) {
            const balanceElement = document.querySelector('.balance-amount');
            if (balanceElement) {
                balanceElement.textContent = `$${newBalance.toFixed(2)}`;
            }
        }

        function addTransaction(type, amount, date, time = null) {
            const transactionList = document.getElementById('transactionList');
            const noTransactions = transactionList.querySelector('.no-transactions');

            // Remove "no transactions" message if it exists
            if (noTransactions) {
                noTransactions.remove();
            }

            // Create transaction item
            const transactionItem = document.createElement('div');
            transactionItem.className = 'transaction-item';

            const isPositive = amount > 0;
            const transactionType = isPositive ? 'Profit' : 'Lose';
            const amountClass = isPositive ? 'positive' : 'negative';
            const amountPrefix = isPositive ? '+' : '';

            // Format date display
            const dateDisplay = time ? `${date} at ${time}` : date;

            transactionItem.innerHTML = `
                <div class="transaction-info">
                    <div class="transaction-type">${transactionType}</div>
                    <div class="transaction-date">${dateDisplay}</div>
                </div>
                <div class="transaction-amount ${amountClass}">
                    ${amountPrefix}$${Math.abs(amount).toFixed(2)}
                </div>
            `;

            // Add to top of list
            transactionList.insertBefore(transactionItem, transactionList.firstChild);
        }

        function showTransactionHistory() {
            const transactionHistory = document.getElementById('transactionHistory');
            if (transactionHistory) {
                transactionHistory.style.display = 'block';
            }
        }

        function hideTransactionHistory() {
            const transactionHistory = document.getElementById('transactionHistory');
            if (transactionHistory) {
                transactionHistory.style.display = 'none';
            }
        }

        // Listen for wallet updates from admin (simulated for now)
        function simulateWalletUpdate(oldBalance, newBalance) {
            const difference = newBalance - oldBalance;
            const currentDate = new Date().toLocaleDateString();

            // Update wallet balance display
            updateWalletBalance(newBalance);

            // Add transaction record
            addTransaction('wallet_update', difference, currentDate);

            // Show notification
            const message = difference > 0
                ? `$${difference.toFixed(2)} was added to your wallet on ${currentDate}`
                : `$${Math.abs(difference).toFixed(2)} lose was made on ${currentDate}`;

            showNotification(message, difference > 0 ? 'success' : 'warning');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            const getNotificationIcon = (type) => {
                switch(type) {
                    case 'success': return '💰'; // Money icon for profits/deposits
                    case 'error': return '💸'; // Money with wings for losses
                    case 'warning': return '⚠️';
                    default: return 'ℹ️';
                }
            };

            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${getNotificationIcon(type)}</span>
                    <span class="notification-message">${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">×</button>
            `;

            // Add to page
            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Update user profile display when logged in
        function updateUserProfile(user) {
            const loginBtn = document.getElementById('loginBtn');
            const userProfile = document.getElementById('userProfile');
            const userName = document.getElementById('userName');
            const userPhoto = document.getElementById('userPhoto');
            const userInitials = document.getElementById('userInitials');
            const dropdownEmail = document.getElementById('dropdownEmail');
            const walletBalance = document.getElementById('walletBalance');
            const notificationBell = document.getElementById('notificationBell');

            if (user) {
                // Show user profile, hide login button
                loginBtn.style.display = 'none';
                userProfile.style.display = 'flex';
                walletBalance.style.display = 'flex';
                notificationBell.style.display = 'flex'; // Show notification bell

                // Set user name and email
                const displayName = user.email.split('@')[0];
                userName.textContent = displayName;
                dropdownEmail.textContent = user.email;

                // Set user initials
                const initials = displayName.substring(0, 2).toUpperCase();
                userInitials.textContent = initials;

                // Handle user photo
                if (user.avatar_url || user.user_metadata?.avatar_url) {
                    const avatarUrl = user.avatar_url || user.user_metadata.avatar_url;
                    userPhoto.innerHTML = `<img src="${avatarUrl}" alt="User" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="this.parentElement.classList.add('placeholder'); this.style.display='none'; document.getElementById('userInitials').style.display='block';">`;
                    userInitials.style.display = 'none';
                } else {
                    userPhoto.classList.add('placeholder');
                    userInitials.style.display = 'block';
                }

                // Show transaction history
                showTransactionHistory();

                // Load user's wallet balance and transactions (would come from backend)
                loadUserData(user.id);

                // Update notification count
                updateNotificationCount();
            } else {
                // Show login button, hide user profile
                loginBtn.style.display = 'block';
                userProfile.style.display = 'none';
                walletBalance.style.display = 'none';
                notificationBell.style.display = 'none'; // Hide notification bell

                // Hide transaction history
                hideTransactionHistory();
            }
        }

        // Toggle user dropdown menu
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userProfile = document.getElementById('userProfile');
            const dropdown = document.getElementById('userDropdown');

            if (userProfile && dropdown && !userProfile.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Session Management with Auto-Logout
        let sessionTimeout;
        let activityTimeout;
        const SESSION_DURATION = 60 * 60 * 1000; // 1 hour in milliseconds
        const ACTIVITY_CHECK_INTERVAL = 5 * 60 * 1000; // Check every 5 minutes

        function setUserSession(user) {
            const sessionData = {
                user: user,
                loginTime: Date.now(),
                lastActivity: Date.now()
            };

            localStorage.setItem('currentUser', user.email);
            localStorage.setItem('currentUserId', user.id);
            localStorage.setItem('userSession', JSON.stringify(sessionData));

            // Start session monitoring
            startSessionMonitoring();

            console.log('✅ User session set with auto-logout after 1 hour');
            console.log('📊 Session data stored:', sessionData);
            console.log('👤 User email stored:', user.email);
            console.log('🆔 User ID stored:', user.id);
        }

        function updateLastActivity() {
            const sessionData = JSON.parse(localStorage.getItem('userSession') || '{}');
            if (sessionData.user) {
                sessionData.lastActivity = Date.now();
                localStorage.setItem('userSession', JSON.stringify(sessionData));
            }
        }

        function startSessionMonitoring() {
            // Clear existing timeouts
            clearTimeout(sessionTimeout);
            clearInterval(activityTimeout);

            // Set up activity monitoring
            activityTimeout = setInterval(() => {
                const sessionData = JSON.parse(localStorage.getItem('userSession') || '{}');
                if (sessionData.user) {
                    const timeSinceLastActivity = Date.now() - sessionData.lastActivity;

                    if (timeSinceLastActivity >= SESSION_DURATION) {
                        console.log('🕐 Session expired due to inactivity');
                        autoLogoutUser('Session expired due to inactivity');
                    }
                }
            }, ACTIVITY_CHECK_INTERVAL);

            // Set up absolute session timeout
            sessionTimeout = setTimeout(() => {
                console.log('🕐 Session expired after 1 hour');
                autoLogoutUser('Session expired');
            }, SESSION_DURATION);
        }

        function autoLogoutUser(reason) {
            console.log('🚪 Auto-logout triggered:', reason);

            // Clear session data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserId');
            localStorage.removeItem('userSession');

            // Clear timeouts
            clearTimeout(sessionTimeout);
            clearInterval(activityTimeout);

            // Update UI
            updateUserProfile(null);

            // Show notification
            showNotification(`Logged out: ${reason}`, 'info');
        }

        // Check and restore user session
        function checkAndRestoreUserSession() {
            const sessionData = JSON.parse(localStorage.getItem('userSession') || '{}');
            const currentUser = localStorage.getItem('currentUser');
            const currentUserId = localStorage.getItem('currentUserId');

            if (sessionData.user && currentUser && currentUserId) {
                const timeSinceLogin = Date.now() - sessionData.loginTime;
                const timeSinceLastActivity = Date.now() - sessionData.lastActivity;

                // Check if session is still valid
                if (timeSinceLastActivity < SESSION_DURATION && timeSinceLogin < SESSION_DURATION) {
                    console.log('🔄 Restoring valid user session for:', currentUser);

                    // Update last activity
                    updateLastActivity();

                    // Create user object for UI update
                    const user = {
                        id: currentUserId,
                        email: currentUser,
                        user_metadata: { email: currentUser }
                    };

                    // Update UI to show logged in state
                    updateUserProfile(user);

                    // Restart session monitoring
                    startSessionMonitoring();

                    console.log('✅ User session restored successfully');
                } else {
                    console.log('🕐 Session expired, auto-logging out');
                    autoLogoutUser('Session expired');
                }
            } else {
                console.log('ℹ️ No existing user session found');
            }
        }

        // Track user activity
        function trackUserActivity() {
            updateLastActivity();
        }

        // Add activity listeners
        document.addEventListener('click', trackUserActivity);
        document.addEventListener('keypress', trackUserActivity);
        document.addEventListener('scroll', trackUserActivity);
        document.addEventListener('mousemove', trackUserActivity);

        // Forgot Password Popup Function
        function showForgotPasswordPopup() {
            // Create a custom popup overlay
            const popupOverlay = document.createElement('div');
            popupOverlay.id = 'forgotPasswordPopup';
            popupOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(5px);
            `;

            // Create popup content
            const popupContent = document.createElement('div');
            popupContent.style.cssText = `
                background: #1A202C;
                border-radius: 12px;
                padding: 30px;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                border: 1px solid #4A5568;
                animation: slideIn 0.3s ease-out;
            `;

            popupContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <h2 style="color: #E2E8F0; margin: 0 0 8px 0; font-size: 24px;">Reset Password</h2>
                    <p style="color: #A0AEC0; margin: 0; font-size: 14px;">Enter your email to receive a password reset link</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #E2E8F0; margin-bottom: 8px; font-size: 14px; font-weight: 500;">Email Address</label>
                    <input type="email" id="popupResetEmail" placeholder="Enter your email address..." style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #2D3748;
                        border: 1px solid #4A5568;
                        border-radius: 8px;
                        color: #E2E8F0;
                        font-size: 14px;
                        box-sizing: border-box;
                    ">
                </div>

                <div style="display: flex; gap: 12px;">
                    <button onclick="sendPasswordResetFromPopup()" style="
                        flex: 1;
                        background: #3182CE;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='#2C5282'" onmouseout="this.style.background='#3182CE'">
                        Send Reset Link
                    </button>
                    <button onclick="closeForgotPasswordPopup()" style="
                        flex: 1;
                        background: #4A5568;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='#2D3748'" onmouseout="this.style.background='#4A5568'">
                        Cancel
                    </button>
                </div>
            `;

            popupOverlay.appendChild(popupContent);
            document.body.appendChild(popupOverlay);

            // Focus on email input
            setTimeout(() => {
                document.getElementById('popupResetEmail').focus();
            }, 100);

            // Close popup when clicking outside
            popupOverlay.addEventListener('click', function(e) {
                if (e.target === popupOverlay) {
                    closeForgotPasswordPopup();
                }
            });

            // Add CSS animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-20px) scale(0.95);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                    }
                }
                @keyframes slideOut {
                    from {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                    }
                    to {
                        opacity: 0;
                        transform: translateY(-20px) scale(0.95);
                    }
                }
            `;
            document.head.appendChild(style);
        }

        function closeForgotPasswordPopup() {
            const popup = document.getElementById('forgotPasswordPopup');
            if (popup) {
                popup.style.animation = 'slideOut 0.2s ease-in forwards';
                setTimeout(() => {
                    popup.remove();
                }, 200);
            }
        }

        function sendPasswordResetFromPopup() {
            const email = document.getElementById('popupResetEmail').value.trim();

            if (!email) {
                showNotification('Please enter your email address', 'error');
                return;
            }

            if (!isValidEmail(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }

            // Simulate sending password reset email
            showNotification('Password reset link sent to your email!', 'success');
            closeForgotPasswordPopup();

            console.log('Password reset requested for:', email);
        }

        // Logout function
        function logoutUser() {
            // Clear session timeouts
            clearTimeout(sessionTimeout);
            clearInterval(activityTimeout);

            // Clear user data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserId');
            localStorage.removeItem('userSession');

            // Clear any user-specific data
            const currentUserId = localStorage.getItem('currentUserId');
            if (currentUserId) {
                localStorage.removeItem(currentUserId);
                localStorage.removeItem(`wallet_update_${currentUserId}`);
            }

            // Update UI
            updateUserProfile(null);

            // Close dropdown
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) {
                dropdown.classList.remove('active');
            }

            // Show success message
            showNotification('Successfully logged out!', 'info');

            console.log('User logged out successfully');
        }

        function loadUserData(userId) {
            // This would normally fetch from your backend/Supabase
            // For now, we'll use localStorage to simulate
            const userData = localStorage.getItem(`user_${userId}`);
            if (userData) {
                const data = JSON.parse(userData);
                updateWalletBalance(data.balance || 0);

                // Load transactions
                if (data.transactions && data.transactions.length > 0) {
                    const transactionList = document.getElementById('transactionList');
                    const noTransactions = transactionList.querySelector('.no-transactions');
                    if (noTransactions) {
                        noTransactions.remove();
                    }

                    data.transactions.forEach(transaction => {
                        addTransaction(transaction.type, transaction.amount, transaction.date);
                    });
                }
            }

            // Start listening for wallet updates from admin
            startWalletUpdateListener(userId);
        }

        // Listen for wallet updates from admin panel
        function startWalletUpdateListener(userId) {
            // Check for wallet updates every 2 seconds
            setInterval(() => {
                const updateKey = `wallet_update_${userId}`;
                const updateData = localStorage.getItem(updateKey);

                if (updateData) {
                    const update = JSON.parse(updateData);

                    // Use the actual amount and real-time date from the admin action
                    const actualAmount = update.actualAmount; // Real amount from admin
                    const realTimeDate = update.realTimeDate; // Real date when admin made the change
                    const difference = update.newBalance - update.oldBalance;

                    // Update wallet balance display
                    updateWalletBalance(update.newBalance);

                    // Add transaction record with real data and time
                    const realTime = new Date(update.timestamp).toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                    addTransaction('admin_update', actualAmount, realTimeDate, realTime);

                    // Show notification with better messaging and colors
                    let message, notificationType;

                    if (actualAmount > 0) {
                        // Check if this is the first deposit for a new user
                        const isFirstDeposit = update.oldBalance === 0;

                        if (isFirstDeposit) {
                            message = `Your deposit of $${actualAmount.toFixed(2)} was successful`;
                            notificationType = 'success';
                        } else {
                            message = `$${actualAmount.toFixed(2)} profit was made`;
                            notificationType = 'success';
                        }
                    } else {
                        message = `$${Math.abs(actualAmount).toFixed(2)} lose was made`;
                        notificationType = 'error'; // Red color for losses
                    }

                    showNotification(message, notificationType);

                    // Save notification to history
                    saveNotificationToHistory(message, notificationType, actualAmount);

                    // Save updated user data with real transaction data including time
                    saveUserData(userId, update.newBalance, actualAmount, realTimeDate, realTime);

                    // Clear the update notification
                    localStorage.removeItem(updateKey);
                }
            }, 2000);
        }

        // Save user data to localStorage
        function saveUserData(userId, newBalance, transactionAmount, date, time = null) {
            let userData = localStorage.getItem(`user_${userId}`);
            if (!userData) {
                userData = { balance: 0, transactions: [] };
            } else {
                userData = JSON.parse(userData);
            }

            // Update balance with real amount
            userData.balance = newBalance;

            // Add transaction with real-time data
            userData.transactions = userData.transactions || [];
            userData.transactions.unshift({
                type: 'admin_update',
                amount: transactionAmount, // Real amount from admin
                date: date, // Real date when admin made change
                time: time, // Real time when admin made change
                timestamp: Date.now() // For sorting purposes
            });

            // Keep only last 50 transactions
            if (userData.transactions.length > 50) {
                userData.transactions = userData.transactions.slice(0, 50);
            }

            localStorage.setItem(`user_${userId}`, JSON.stringify(userData));
        }

        // Check if user is blocked
        function checkUserStatus(userId) {
            // This would normally check with your backend
            // For demo purposes, we'll simulate this
            const blockedUsers = JSON.parse(localStorage.getItem('blocked_users') || '[]');

            if (blockedUsers.includes(userId)) {
                // User is blocked, sign them out and show message
                signOutUser();
                showNotification('Your account has been blocked by an administrator. Please contact support at customerservicecoinmarket24@gmail.com', 'warning');
                return false;
            }

            return true;
        }

        // Enhanced sign-in function with status check
        async function signInWithEmailEnhanced() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }

            if (!validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }

            try {
                // Get user data from localStorage
                const userData = localStorage.getItem(email);
                if (!userData) {
                    alert('User not found. Please register first.');
                    return;
                }

                const user = JSON.parse(userData);

                // Verify password
                if (user.password !== password) {
                    alert('Invalid password. Please try again.');
                    return;
                }

                // Create user ID for tracking
                const userId = email.replace('@', '_').replace('.', '_').replace(/[^a-zA-Z0-9_]/g, '_');

                // Check if user is blocked
                if (!checkUserStatus(userId)) {
                    return;
                }

                // Update UI for logged in user
                updateUserProfile(user);

                // Load user data and START WALLET UPDATE LISTENER
                loadUserData(userId);

                // Store current user for session
                localStorage.setItem('currentUser', email);
                localStorage.setItem('currentUserId', userId);

                closeAuthModal();

                showNotification('Successfully signed in! Wallet notifications are now active.', 'success');

            } catch (error) {
                console.error('Sign in error:', error);
                alert('Sign in failed: ' + error.message);
            }
        }

        // Homepage navigation function
        function goToHomepage() {
            window.location.href = 'coinmarketcap.html';
        }

        // Pull to Refresh Functionality
        let startY = 0;
        let currentY = 0;
        let isPulling = false;
        let isRefreshing = false;

        function initPullToRefresh() {
            const pullToRefresh = document.getElementById('pullToRefresh');
            const refreshIcon = pullToRefresh.querySelector('.refresh-icon');
            const refreshText = document.getElementById('refreshText');

            // Touch events for mobile
            document.addEventListener('touchstart', (e) => {
                if (window.scrollY === 0 && !isRefreshing) {
                    startY = e.touches[0].clientY;
                    isPulling = true;
                }
            });

            document.addEventListener('touchmove', (e) => {
                if (!isPulling || isRefreshing) return;

                currentY = e.touches[0].clientY;
                const pullDistance = currentY - startY;

                if (pullDistance > 0 && pullDistance < 150) {
                    e.preventDefault();
                    pullToRefresh.style.transform = `translateX(-50%) translateY(${Math.min(pullDistance - 100, 0)}px)`;
                    pullToRefresh.style.opacity = Math.min(pullDistance / 100, 1);

                    if (pullDistance > 80) {
                        refreshText.textContent = 'Release to refresh';
                        pullToRefresh.style.background = 'linear-gradient(135deg, #48BB78, #38A169)';
                    } else {
                        refreshText.textContent = 'Pull down to refresh';
                        pullToRefresh.style.background = 'linear-gradient(135deg, #3182CE, #2C5282)';
                    }
                }
            });

            document.addEventListener('touchend', (e) => {
                if (!isPulling || isRefreshing) return;

                const pullDistance = currentY - startY;

                if (pullDistance > 80) {
                    triggerRefresh();
                } else {
                    resetPullToRefresh();
                }

                isPulling = false;
            });

            // Mouse events for desktop testing
            document.addEventListener('mousedown', (e) => {
                if (window.scrollY === 0 && !isRefreshing && e.clientY < 100) {
                    startY = e.clientY;
                    isPulling = true;
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (!isPulling || isRefreshing) return;

                currentY = e.clientY;
                const pullDistance = currentY - startY;

                if (pullDistance > 0 && pullDistance < 150) {
                    e.preventDefault();
                    pullToRefresh.style.transform = `translateX(-50%) translateY(${Math.min(pullDistance - 100, 0)}px)`;
                    pullToRefresh.style.opacity = Math.min(pullDistance / 100, 1);

                    if (pullDistance > 80) {
                        refreshText.textContent = 'Release to refresh';
                        pullToRefresh.style.background = 'linear-gradient(135deg, #48BB78, #38A169)';
                    } else {
                        refreshText.textContent = 'Pull down to refresh';
                        pullToRefresh.style.background = 'linear-gradient(135deg, #3182CE, #2C5282)';
                    }
                }
            });

            document.addEventListener('mouseup', (e) => {
                if (!isPulling || isRefreshing) return;

                const pullDistance = currentY - startY;

                if (pullDistance > 80) {
                    triggerRefresh();
                } else {
                    resetPullToRefresh();
                }

                isPulling = false;
            });
        }

        function triggerRefresh() {
            if (isRefreshing) return;

            isRefreshing = true;
            const pullToRefresh = document.getElementById('pullToRefresh');
            const refreshIcon = pullToRefresh.querySelector('.refresh-icon');
            const refreshText = document.getElementById('refreshText');

            pullToRefresh.classList.add('show', 'refreshing');
            refreshIcon.classList.add('spinning');
            refreshText.textContent = 'Refreshing...';

            // Refresh all data
            Promise.all([
                refreshCryptoData(),
                refreshUserData(),
                refreshNotifications()
            ]).then(() => {
                setTimeout(() => {
                    resetPullToRefresh();
                    showNotification('✅ Data refreshed successfully!', 'success');
                }, 1000);
            }).catch(() => {
                setTimeout(() => {
                    resetPullToRefresh();
                    showNotification('❌ Failed to refresh data', 'error');
                }, 1000);
            });
        }

        function resetPullToRefresh() {
            const pullToRefresh = document.getElementById('pullToRefresh');
            const refreshIcon = pullToRefresh.querySelector('.refresh-icon');
            const refreshText = document.getElementById('refreshText');

            pullToRefresh.classList.remove('show', 'refreshing');
            refreshIcon.classList.remove('spinning');
            refreshText.textContent = 'Pull down to refresh';
            pullToRefresh.style.transform = 'translateX(-50%) translateY(-100%)';
            pullToRefresh.style.opacity = '0';
            pullToRefresh.style.background = 'linear-gradient(135deg, #3182CE, #2C5282)';

            isRefreshing = false;
        }

        function refreshCryptoData() {
            return new Promise((resolve) => {
                // Simulate crypto data refresh
                updateCryptoPrices();
                setTimeout(resolve, 500);
            });
        }

        function refreshUserData() {
            return new Promise((resolve) => {
                // Refresh user wallet and notifications
                if (isUserLoggedIn()) {
                    loadUserWallet();
                    loadNotifications();
                }
                setTimeout(resolve, 300);
            });
        }

        function refreshNotifications() {
            return new Promise((resolve) => {
                // Refresh notification count
                updateNotificationCount();
                setTimeout(resolve, 200);
            });
        }

        // Auto-start wallet listener if user is already logged in
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize notification system FIRST before any other operations
            window.notificationHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');

            // Check and restore user session
            checkAndRestoreUserSession();

            const currentUser = localStorage.getItem('currentUser');
            const currentUserId = localStorage.getItem('currentUserId');

            if (currentUser && currentUserId) {
                console.log('Auto-starting wallet update listener for logged-in user:', currentUser);

                // Load user data and start wallet listener
                loadUserData(currentUserId);

                // Update UI to show user is logged in
                const userData = localStorage.getItem(currentUser);
                if (userData) {
                    const user = JSON.parse(userData);
                    updateUserProfile(user);
                }

                // Show notification that system is ready
                setTimeout(() => {
                    showNotification('Welcome back! Wallet notifications are active.', 'info');
                }, 1000);
            }
        });

        // Initialize pull-to-refresh functionality
        initPullToRefresh();

        function saveNotificationToHistory(message, type, amount) {
            // Initialize if not already done
            if (!window.notificationHistory) {
                window.notificationHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
            }

            const notification = {
                id: Date.now(),
                message: message,
                type: type,
                amount: amount,
                timestamp: new Date().toISOString(),
                read: false
            };

            window.notificationHistory.unshift(notification);

            // Keep only last 50 notifications
            if (window.notificationHistory.length > 50) {
                window.notificationHistory = window.notificationHistory.slice(0, 50);
            }

            localStorage.setItem('notificationHistory', JSON.stringify(window.notificationHistory));
            updateNotificationCount();
        }

        function updateNotificationCount() {
            // Initialize if not already done
            if (!window.notificationHistory) {
                window.notificationHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
            }

            const unreadCount = window.notificationHistory.filter(n => !n.read).length;
            const countElement = document.getElementById('notificationCount');

            if (countElement) {
                if (unreadCount > 0) {
                    countElement.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    countElement.classList.remove('hidden');
                } else {
                    countElement.classList.add('hidden');
                }
            }
        }

        function openNotificationsPage() {
            // Initialize if not already done
            if (!window.notificationHistory) {
                window.notificationHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
            }

            const modal = document.getElementById('notificationsModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            renderNotificationsList();

            // Mark all as read
            window.notificationHistory.forEach(n => n.read = true);
            localStorage.setItem('notificationHistory', JSON.stringify(window.notificationHistory));
            updateNotificationCount();
        }

        function closeNotificationsPage() {
            const modal = document.getElementById('notificationsModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function renderNotificationsList() {
            // Initialize if not already done
            if (!window.notificationHistory) {
                window.notificationHistory = JSON.parse(localStorage.getItem('notificationHistory') || '[]');
            }

            const listElement = document.getElementById('notificationsList');

            if (window.notificationHistory.length === 0) {
                listElement.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #A0AEC0;">
                        <div style="font-size: 48px; margin-bottom: 16px;">🔔</div>
                        <h3 style="color: #FFFFFF; margin-bottom: 8px;">No notifications yet</h3>
                        <p>Your wallet activity notifications will appear here</p>
                    </div>
                `;
                return;
            }

            listElement.innerHTML = window.notificationHistory.map(notification => {
                const date = new Date(notification.timestamp);
                const timeAgo = getTimeAgo(date);

                const getNotificationStyle = (type) => {
                    switch(type) {
                        case 'success': return 'border-left: 4px solid #48BB78; background: linear-gradient(135deg, #1A202C, #22543D);';
                        case 'error': return 'border-left: 4px solid #F56565; background: linear-gradient(135deg, #1A202C, #742A2A);';
                        case 'warning': return 'border-left: 4px solid #ED8936; background: linear-gradient(135deg, #1A202C, #744210);';
                        default: return 'border-left: 4px solid #3182CE; background: linear-gradient(135deg, #1A202C, #2A4365);';
                    }
                };

                const getNotificationIcon = (type) => {
                    switch(type) {
                        case 'success': return '💰';
                        case 'error': return '💸';
                        case 'warning': return '⚠️';
                        default: return 'ℹ️';
                    }
                };

                return `
                    <div style="margin-bottom: 12px; padding: 16px; border-radius: 8px; ${getNotificationStyle(notification.type)}">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="font-size: 20px;">${getNotificationIcon(notification.type)}</span>
                            <div style="flex: 1;">
                                <div style="color: #FFFFFF; font-weight: 600; margin-bottom: 4px;">
                                    ${notification.message}
                                </div>
                                <div style="color: #A0AEC0; font-size: 12px;">
                                    ${timeAgo} • ${date.toLocaleDateString()} at ${date.toLocaleTimeString()}
                                </div>
                            </div>
                            ${notification.amount ? `
                                <div style="color: ${notification.type === 'success' ? '#48BB78' : '#F56565'}; font-weight: bold; font-size: 16px;">
                                    ${notification.amount > 0 ? '+' : ''}$${Math.abs(notification.amount).toFixed(2)}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            return date.toLocaleDateString();
        }

        function clearAllNotifications() {
            if (confirm('Are you sure you want to clear all notifications?')) {
                window.notificationHistory = [];
                localStorage.setItem('notificationHistory', JSON.stringify(window.notificationHistory));
                updateNotificationCount();
                renderNotificationsList();
            }
        }

        // Handle click outside notifications modal to close
        document.getElementById('notificationsModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeNotificationsPage();
            }
        });

        // Handle Escape key to close notifications modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && document.getElementById('notificationsModal').classList.contains('active')) {
                closeNotificationsPage();
            }
        });

        // Initialize notification count on page load
        updateNotificationCount();

        // Crypto Icon Handling Functions
        function getCoinIcon(crypto) {
            // Define symbol-specific mappings for better reliability
            const symbolMappings = {
                'BTC': 'https://cryptologos.cc/logos/bitcoin-btc-logo.png',
                'ETH': 'https://cryptologos.cc/logos/ethereum-eth-logo.png',
                'USDT': 'https://cryptologos.cc/logos/tether-usdt-logo.png',
                'XRP': 'https://cryptologos.cc/logos/xrp-xrp-logo.png',
                'BNB': 'https://cryptologos.cc/logos/bnb-bnb-logo.png',
                'SOL': 'https://cryptologos.cc/logos/solana-sol-logo.png',
                'USDC': 'https://cryptologos.cc/logos/usd-coin-usdc-logo.png',
                'ADA': 'https://cryptologos.cc/logos/cardano-ada-logo.png',
                'DOGE': 'https://cryptologos.cc/logos/dogecoin-doge-logo.png',
                'TRX': 'https://cryptologos.cc/logos/tron-trx-logo.png',
                'AVAX': 'https://cryptologos.cc/logos/avalanche-avax-logo.png',
                'SHIB': 'https://cryptologos.cc/logos/shiba-inu-shib-logo.png',
                'DOT': 'https://cryptologos.cc/logos/polkadot-new-dot-logo.png',
                'LINK': 'https://cryptologos.cc/logos/chainlink-link-logo.png',
                'MATIC': 'https://cryptologos.cc/logos/polygon-matic-logo.png',
                'LTC': 'https://cryptologos.cc/logos/litecoin-ltc-logo.png',
                'UNI': 'https://cryptologos.cc/logos/uniswap-uni-logo.png',
                'ATOM': 'https://cryptologos.cc/logos/cosmos-atom-logo.png',
                'ETC': 'https://cryptologos.cc/logos/ethereum-classic-etc-logo.png'
            };

            // Try multiple sources for better reliability
            const iconSources = [
                symbolMappings[crypto.symbol?.toUpperCase()], // Symbol-specific mapping
                crypto.logo, // Primary source from database
                `https://cryptologos.cc/logos/${crypto.name?.toLowerCase().replace(/\s+/g, '-')}-${crypto.symbol?.toLowerCase()}-logo.png`,
                `https://coinicons-api.vercel.app/api/icon/${crypto.symbol?.toLowerCase()}`,
                `https://assets.coingecko.com/coins/images/${getCoinGeckoId(crypto.symbol)}/small/${crypto.name?.toLowerCase().replace(/\s+/g, '_')}.png`,
                `https://via.placeholder.com/32x32/3182CE/FFFFFF?text=${crypto.symbol?.substring(0, 2) || '??'}`
            ];

            // Return the first available source
            return iconSources.find(src => src && src !== 'undefined') || iconSources[iconSources.length - 1];
        }

        function getCoinGeckoId(symbol) {
            // Map common symbols to CoinGecko IDs
            const symbolMap = {
                'BTC': '1',
                'ETH': '279',
                'USDT': '825',
                'XRP': '52',
                'BNB': '1839',
                'SOL': '5426',
                'USDC': '3408',
                'ADA': '2010',
                'DOGE': '5',
                'TRX': '1958'
            };
            return symbolMap[symbol.toUpperCase()] || '1';
        }

        let iconErrorCount = {};

        function handleIconError(img, symbol) {
            if (!iconErrorCount[symbol]) {
                iconErrorCount[symbol] = 0;
            }

            iconErrorCount[symbol]++;

            // Try alternative sources
            const alternativeSources = [
                `https://cryptologos.cc/logos/${symbol.toLowerCase()}-logo.png`,
                `https://coinicons-api.vercel.app/api/icon/${symbol.toLowerCase()}`,
                `https://assets.coingecko.com/coins/images/${getCoinGeckoId(symbol)}/small/${symbol.toLowerCase()}.png`,
                `https://via.placeholder.com/32x32/3182CE/FFFFFF?text=${symbol.substring(0, 2)}`
            ];

            if (iconErrorCount[symbol] <= alternativeSources.length) {
                img.onerror = () => handleIconError(img, symbol);
                img.src = alternativeSources[iconErrorCount[symbol] - 1];
            } else {
                // Final fallback - create a text-based icon
                img.onerror = null;
                img.src = `data:image/svg+xml;base64,${btoa(`
                    <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="16" cy="16" r="16" fill="#3182CE"/>
                        <text x="16" y="20" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">
                            ${symbol.substring(0, 2)}
                        </text>
                    </svg>
                `)}`;
            }
        }
    </script>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
        <div class="newsletter-content">
            <div class="newsletter-text">
                <h2>Stay on top of crypto. All the time, any time.</h2>
                <p>Please keep me updated by email with the latest crypto news, research findings, reward programs, event updates, coin listings and more information from CoinMarketCap.</p>
            </div>
            <div class="newsletter-form">
                <input type="email" placeholder="Enter your e-mail address" class="newsletter-input">
                <button class="newsletter-btn">Subscribe</button>
            </div>
        </div>
        <div class="newsletter-graphic">
            <div class="crypto-icons">
                <div class="crypto-icon btc">₿</div>
                <div class="crypto-icon eth">Ξ</div>
                <div class="crypto-icon chart">📈</div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <div class="logo">
                    <div class="logo-icon">₿</div>
                    CoinMarketCap
                </div>
                <div class="footer-language">
                    <select class="language-select">
                        <option>🇺🇸 English</option>
                        <option>🇪🇸 Español</option>
                        <option>🇫🇷 Français</option>
                    </select>
                    <div class="currency-select">💲 USD</div>
                </div>
            </div>

            <div class="footer-columns">
                <div class="footer-column">
                    <h3>Products</h3>
                    <ul>
                        <li><a href="#">Academy</a></li>
                        <li><a href="#">Advertise</a></li>
                        <li><a href="#">CMC Labs</a></li>
                        <li><a href="#">CMC Updates</a></li>
                        <li><a href="#">Bitcoin ETFs</a></li>
                        <li><a href="#">Crypto API</a></li>
                        <li><a href="#">DexScan</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="#">About us</a></li>
                        <li><a href="#">Terms of use</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie preferences</a></li>
                        <li><a href="#">Cookie policy</a></li>
                        <li><a href="#">Community Rules</a></li>
                        <li><a href="#">Disclaimer</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Get Listed</a></li>
                        <li><a href="#">Request Form</a></li>
                        <li><a href="#">Contact Support</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Glossary</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><a href="mailto:customerservicecoinmarket24@gmail.com?subject=CoinMarketCap Support Request&body=Hello CoinMarketCap Support Team,%0D%0A%0D%0AI need assistance with:%0D%0A%0D%0APlease describe your issue here...%0D%0A%0D%0AThank you!"
                               style="color: #3182CE; text-decoration: none; transition: color 0.2s ease;"
                               onmouseover="this.style.color='#2C5282'"
                               onmouseout="this.style.color='#3182CE'"
                               title="Click to send us an email">
                            📧 customerservicecoinmarket24@gmail.com
                        </a></li>
                        <li><a href="#">X (Twitter)</a></li>
                        <li><a href="#">Community</a></li>
                        <li><a href="#">Telegram</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Reddit</a></li>
                        <li><a href="#">LinkedIn</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Pull to Refresh Indicator -->
    <div id="pullToRefresh" class="pull-to-refresh">
        <span class="refresh-icon">🔄</span>
        <span id="refreshText">Pull down to refresh</span>
    </div>

    <!-- Floating Support Button -->
    <a href="mailto:customerservicecoinmarket24@gmail.com?subject=CoinMarketCap Support Request&body=Hello CoinMarketCap Support Team,%0D%0A%0D%0AI need assistance with:%0D%0A%0D%0APlease describe your issue here...%0D%0A%0D%0AThank you!"
       class="floating-support"
       title="Contact Support - We're here to help!">
        📧 Need Help?
    </a>
</body>
</html>
